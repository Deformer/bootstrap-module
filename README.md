# Messaging app bootstrap module

Этот модуль предназанчен для развертывания и тестирования приложения по обмену сообщениями


## Требуемое ПО
### Для того чтобы запустить и протестировать данное приложение вам понадобится:

* NodeJS => 8.9.0
* npm => 5.0
* docker
* docker-compose
* git

## Развертывание

* Для начанла вам необходимо скопировать данный репозиторий
* Далее нужно запустить команду `sh get-repos.sh`, которая склонирует все необходимые сервисы для развертывания приложения
* Далее необхидо создать файлы для переменных окружения в клонированных сервисах, для этого ужно создать файл .env в chat-service, auth-service и web-sockets. Пример с форматом переменных лежит в файле .env.example в любом из выше перечисленных сервисов
* Далее запустите команду `docker-compose up -d postgres`, которая запустит контейнер с базой данных
* Далее необходимо удостовериться, что база данных успешно запустилась и готова обслуживать соединения. Для этого можно использовать команду `docker-compose logs`. Если база данных не смогла стартовать по причине отсутсвия прав доступа, нужно их выдать командой `chmod 0700 volumes/postgres`, если по какой то другой причине, может помочь повторный запуск контейнера с базой данных
* Если приложение развертывается впервые, то нужно осуществить миграцию данных, для этого запустите команду `docker-compose up -d migration`
* После всех выше упомянутых команд можно запустить все приложение командой `docker-compose up --build`
* Точка входа в приложение в таком случае будет localhost:3000, для доступа к API приложения нужно обращаться в точку входа localhost:3000/api

## Тестирование

* Для начала запустите команду `npm i`, которая установит все необходимые зависимости для тестирования приложения
* Далее нужно развернуть тестовую среду:
    * Запустите команду `docker-compose -f docker-compose-test.yml up -d postgres` и убедитесь, что тестовая база данных успешно развернулась (`docker-compose -f docker-compose-test.yml logs`)
    * Далее проведите миграцию для тестовой базы данных командой `docker-compose -f docker-compose-test.yml up -d migration`
    * После чего разверните приложение для проведения тестов `docker-compose -f docker-compose-test.yml up --build`
* После выполнения всех выше указанных пунктов используйте команду `npm run test` (в новой сессии терминала) для запуска автоматических тестов
